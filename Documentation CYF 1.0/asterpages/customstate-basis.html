<!DOCTYPE html>
<!--
since you're here anyway: there's a small easter egg on the text commands page but it's probably not worth finding, sorry
you may notice this page's code is garbage: i'm not a web designer! ;-;
it's w3c valid, at least
-->

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>*CYF Documentation - Custom State</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="../css/themesidebar.css" rel="stylesheet">
    <link href="../css/shThemeRDark.css" rel="stylesheet">

    <!-- Syntax highlighting -->
    <script type="text/javascript" src="../js/shCore.js"></script>
    <script type="text/javascript" src="../js/shBrushLua.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<img src="../img/bg2.png" alt="Undertale background" class="backimg">
<div class="container arena black">
    <div class="col-md-2">
        <!--navigation-->
        <nav class="nav-sidebar">
            <ul class="nav tabs">
                <li class="li-header">Basics</li>
                    <li><a href="../documentation.html">Welcome</a></li>
                    <li><a href="../pages/howtoread.html">How to read this documentation</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li><a href="../pages/controls.html">Controls</a></li>
                    <li><a href="../pages/basic.html">Basic setup</a></li>
                    <li><a href="../pages/unity.html"><span class="CYF"></span> Unity Setup (Optional)</a></li>
                    <li class="asternew"><a href="../pages/variables.html">Special Variables</a></li>
                    <li><a href="../pages/terms.html">Terminology</a></li>
                <li class="li-header">API</li>
                    <li><a href="../pages/api-text.html">Text commands</a></li>
                    <li class="asternew"><a href="../pages/api-events.html">Game events</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="li-indent">Functions &amp; Objects:</li>
                        <li class="li-indent asternew"><a href="../pages/api-functions-main.html">Misc. Functions</a></li>
                        <li class="li-indent"><a href="../pages/api-functions-player.html">The Player Object</a></li>
                        <li class="li-indent"><a href="../pages/api-functions-script.html">The Script Object</a></li>
                        <li class="li-indent"><a href="../pages/api-functions-audio.html">The Audio Object</a></li>
                        <li class="li-indent"><a href="../pages/api-functions-newaudio.html"><span class="CYF"></span> The NewAudio Object</a></li>
                        <li class="li-indent"><a href="../pages/api-functions-input.html">The Input Object</a></li>
                        <li class="li-indent"><a href="../pages/api-functions-time.html">The Time Object</a></li>
                        <li class="li-indent"><a href="../pages/cyf-inventory.html"><span class="CYF"></span> The Inventory Object</a></li>
                        <li class="li-indent asternew"><a href="../pages/api-functions-misc.html"><span class="CYF"></span>The Misc Object</a></li>
                        <li class="li-indent"><a href="../pages/api-functions-discord.html"><span class="CYF"></span> The Discord Object</a></li>
                        <li class="li-indent"><a href="../pages/api-functions-waves.html">The Arena Object</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li><a href="../pages/api-projectile.html">Projectile management</a></li>
                    <li><a href="../pages/cyf-ppcollision.html"><span class="CYF"></span> The Pixel-Perfect Collision System</a></li>
                    <li class="asternew"><a href="../pages/api-animation.html">Sprites &amp; Animation</a></li>
                    <li class="asternew"><a href="../pages/cyf-text.html"><span class="CYF"></span> The Text Object</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                <li class="li-header"><span class="Asterisk"></span> AsteriskMod</li>
                    <li><a href="basis.html">About</a></li>
                    <li class="asternew"><a href="setup.html">Additional Setup</a></li>
                    <li class="asternew"><a href="misc.html">Misc.Changes</a></li>
                    <li>Functions &amp; Objects:</li>
                    <li class="li-indent"><a href="api-engine.html"><span class="Future"></span> The Engine Object</a></li>
                    <li class="li-indent asternew"><a href="api-playerutil.html">The PlayerUtil Object</a></li>
                    <li class="li-indent asternew"><a href="api-buttonutil.html">The ButtonUtil Object</a></li>
                    <li class="li-indent asternew"><a href="api-arenautil.html">The ArenaUtil Object</a></li>
                    <li>CustomState:</li>
                    <li class="li-indent asternew active" style="margin-left:5px;">&gt; Basis &lt;</li>
                    <li class="li-indent"><a href="customstate-variable.html">Available Var/Fun/Obj</a></li>
                    <li class="li-indent"><a href="customstate-event.html">Available Events</a></li>
                    <li class="li-indent asternew"><a href="customstate-stateeditor.html">The StateEditor Object</a></li>
                    <li><span class="Future"></span> Gameobject Modifying System:</li>
                    <li class="li-indent"><a href="gms-basis.html">Basis</a></li>
                    <li class="li-indent"><a href="gms-main.html">The GameObject Object</a></li>
                    <li class="li-indent"><a href="gms-image.html">The ImageComponent Object</a></li>
                    <hr style="margin-top:10px;margin-bottom:10px;">
                <li class="li-header"></span><span class="CYF"></span> Shaders</li>
                    <li><a href="../pages/shaders.html">Introduction</a></li>
                    <li><a href="../pages/shaders-object.html">The Shader Object</a></li>
                    <li><a href="../pages/shaders-coding.html">Coding a Shader</a></li>
                    <hr style="margin-top:10px;margin-bottom:10px;">
                <li class="li-header"><span class="CYF"></span> Overworld</li>
                    <li><a href="../pages/overworld.html">Basics</a></li>
                    <li><a href="../pages/overworld-howto-map.html">How to create a map</a></li>
                    <li><a href="../pages/overworld-howto-event.html">How to create an event</a></li>
                    <li><a href="../pages/overworld-howto-animevent.html">How to animate an event</a></li>
                    <li><a href="../pages/overworld-howto-shop.html">How to create a shop</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="li-indent"><span class="CYF"></span> Overworld Objects:</li>
                        <li class="li-indent"><a href="../pages/overworld-object-general.html">The General Object</a></li>
                        <li class="li-indent"><a href="../pages/overworld-object-event.html">The Event Object</a></li>
                        <li class="li-indent"><a href="../pages/overworld-object-player.html">The Player Object</a></li>
                        <li class="li-indent"><a href="../pages/overworld-object-screen.html">The Screen Object</a></li>
                        <li class="li-indent"><a href="../pages/overworld-object-inventory.html">The Inventory Object</a></li>
                        <li class="li-indent"><a href="../pages/overworld-object-map.html">The Map Object</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                <li class="li-header">Resources</li>
                    <li><a href="../media/dialogoptions.png">Dialog bubble names</a></li>
                    <li><a href="../pages/api-keys.html"><span class="CYF"></span> Key List</a></li>
            </ul>
        </nav>
    </div>
    <!--tabs'n'shit-->
    <div class="tab-content col-md-10">
        <div class="tab-pane active text-style" id="asterisk-customstate">
            <h2><span class="Asterisk"></span> CustomState</h2><br><br>
            <p>
                CustomState is one of very strong feature in Asterisk Mod.<br>
                Asterisk Mod adds new type of script, named <span class="term">State Script</span>.<br>
                You can control your state with that script.
                <br><br>
                This feature is <b><u>NOT</u></b> similarly to CustomState in CYF v0.6.6.
            </p><br>

            <hr>

            <h3>Basic Setup</h3>

            <p>
                The <i>State scripts</i> are located in <span class="term">YOUR MOD/Lua/States/</span>.<br>
                After you create files, what you should do is to write <span class="term">StateStarting()</span> and <span class="term">StateEnding()</span> in the script.
            </p><br>

            <h3>How to enter to your CustomState</h3>

            <p>
                <br><span class="function"><span class="Asterisk"></span> <span class="string"></span> customstatename [E]</span>
                A name of your CustomState.<br>
                you want when you want to enter CustomState. You can modify this at any time, and it'll get read out before it enters any CustomState (when you call <span class="term">State("CUSTOMSTATE")</span>).
            </p>

            <p>
                <br><span class="function"><span class="Asterisk"></span> State("CUSTOMSTATE") [E/M/W/S]</span>
                When starting this state, <span class="term">customstatename</span> is read out from the Encounter script and the script in the States folder with matching name will be CustomState.
                <br><br>
                You can call this function in the state script, so you can go anothor CustomState from CustomState.
            </p>

            <p>
                <br><span class="function"><span class="Asterisk"></span> State("*" + <span class="string"></span> customstatename) [E/M/W/S]</span>
                You can assign <span class="term">customstatename</span> and enter the CustomState at the same time by using this!<br>
                For example, enters to <span class="term">"ITEMMENUALT"</span> by writing <span class="term">"State("*ITEMMENUALT")</span>.
            </p><br>

            <p>
                <font color="#FFF">* You can enter CustomState by using above 2 features.</font>
            </p><br>

            <hr><br>

            <h3>Available variables, function and objects</h3>

            <p>
                You can use almost features written <span class="term">[E/M/W]</span> in this document to state scripts.<br>
                Additionally, you can use <span class="term">the Arena object</span> and 
                <span class="term">the StateEditor object</span> to control UIs.<br>
                Moreover, <span class="term">Player.SetControlOverride()</span> works in the scripts.
                <br><br>
                See pages in <span>CustomState</span> scetion for more information.
            </p><br>

            <hr><br>

            <h3>Tutorial</h3><br><br>

            <p>
                CustomState is created as if you could add codes into CYF's engine.<br>
                If you know and understand the engine's codes, you maybe know way to write the codes of State Scripts.<br>
                However, not everyone download and know the source code , C# or Unity.<br>
                I will some tips and tutorial in this page.<br>
                Here we go.
            </p><br>

            <h4>Basis</h4>

            <p>
                In the first, there is the comparatively easy example. 
                That is Fake Scene.<br>
                ...
                <br><br>
                "What is the Fake Scene?"<br>
                umm, that means for example, GameOver Screen, Revive Screen or Overworld.<br>
                If you are not satisfied about that and wanna recreate that, CustomState helps you.<br>
                ah... that can do by Wave Script, but you can separate real wave and fake scene by this.
                <br><br>
                Of course, CustomState is not only for creating that.<br>
                Letterly, CustomState can be created your custom own state.<br>
                For example, creating Japanese-styled ITMEMENU.
                <br><br>
                You can check the examples in <span class="term">Asterisk Mod Features 2</span> Mod.
            </p><br>

            <h4>Prepare</h4>

            <p>
                Actually let's try to use CustomState.<br>
                First, you have to create <span class="term">States</span> folder in <span class="term">Lua</span> folder.<br>
                Second, create lua file named state's name that you have thought and write below code:<br>
<div class="code-container"><pre class="brush: lua"> -- State Script --
function StateStarting(oldstate)
end

function StateEnding(newstate)
end
</pre></div>
                These 2 functions (game event) is required in any State Scripts.<br><br>
                There are some pattern of using CustomState, but let's try to create the state like <span class="term">DIALOGRESULT</span> as tutorial.
            </p><br>

            <h4>The StateEditor Object</h4>

            <p>
                In State Scripts, you can use variables and functions that is used in any other scripts (displayed [E/M/W]).
                Additionally, you can also use <span class="term">The Arena Object</span> and <span class="ref">The StateEditor Object</span> can be used in only State Scripts.<br>
                For example, <span class="term">The StateEditor Object</span> can be control the text object in the arena (dialog box).<br><br>
                OK, Let's create the state like <span class="term">DIALOGRESULT</span>...<br>
                Wait.<br>
                Before create CustomState, you check the below:<br>
                <ul>
                    <li>Whether the text (in arena) will be shown or hiden?</li>
                    <li>Whether the buttons' will be keepd active (yellow buttons) or be inactivate (orange buttons)?</li>
                    <li>Whether the Player's soul will be shown or hiden?</li>
                    <li>Will you modify the arena? ("modify" means resizing or moving)</li>
                </ul><br>
                If you don't know above status in <span class="term">DIALOGRESULT</span>, you should check that.<br><br>
                OK? What we have to do is below:<br>
                <ul>
                    <li>show the text in arena</li>
                    <li>keep active(color) of the buttons</li>
                    <li>hide the Player's soul</li>
                    <li>won't modify the arena</li>
                </ul><br>
                Any dialog text is up for anything. Let's write code that runs above.<br>
<div class="code-container"><pre class="brush: lua"> -- State Script --
function StateStarting(oldstate)
    StateEditor.SetDialogText("Hello AsteriskMod!") -- set text
    -- StateEditor.SetButtonActive() -- If you wanna inactiveate (color orange) all butoon, call it.
    StateEditor.SetPlayerVisible(false) -- hide the soul
end

function StateEnding(newstate)
    -- StateEditor.ResetArena() -- Call it in StateEnding() after modifying arena.
end
</pre></div>
                <br>
                Wrote? next, you need to write to move CustomState in Encounter Script.<br>
                You should assgin your state name (file name without extension) to <span class="term">customstatename</span> and call <span class="term">State("CUSTOMSTATE")</span>.<br>
<div class="code-container"><pre class="brush: lua">-- Encounter Script --
function EncounterStarting()
    customstatename = "Tutorial" -- If you create file naming "Tutorial" in States folder
    State("CUSTOMSTATE")
end
</pre></div>
                Let's run the mod!
                <br><br>
                ...the engine will not receive any your input, won't you?<br>
                Yeah, that means code works correctly.
            </p><br>


            <h4>"Handle" Events</h4>

            <p>
                CustomState has 3 functions of handle.<br>
<div class="code-container"><pre class="brush: lua"> -- State Script --
function HandleAction()
end

function HandleArrows(left, right, up, down)
end

function HandleCancel()
end
</pre></div>
                <span class="term">HandleAction()</span> is called on a first frame of pressing Confirm Key (<span class="term">Z</span> or <span class="term">Enter</span> key).<br>
                <span class="term">HandleArrows()</span> is called on a first frame of pressing any arrow keys. Each arguments are <span class="boolean"></span>.<br>
                <span class="term">HandleCancel()</span> is called on a first frame of pressing Cancel Key (<span class="term">X</span> or <span class="term">Shift</span> key).
                <br><br>
                We will complete to create <span class="term">DIALOGRESULT</span> by using those.<br>
                We need to enable to skip dialog text.<br>
<div class="code-container"><pre class="brush: lua"> -- State Script --
function HandleCancel()
    StateEditor.SkipDialogText()
end
</pre></div>
                <br>
                aaaaaaand last,<br>
                We enable to go to <span class="term">ENEMYDIALOGUE</span> by pressing Confirm Key when text is shown completely.<br>
<div class="code-container"><pre class="brush: lua"> -- State Script --
function HandleAction()
    if StateEditor.GetLineCompleteDialogText() then
        State("ENEMYDIALOGUE")
    end
end
</pre></div><br>
                We're done!
            </p><br>

            <h4>Misc.</h4>

            <p>
                Of course, CustomState is not for only reprodcing DIALOGRESULT.<br>
                You can create states like <span class="term">ACTMENU</span> or <span class="term">MERCYMENU</span> by using <span class="term">StateEditor.SetChoicesDialogText()</span> and <span class="term">StateEditor.SetPlayerOnSelection()</span>.<br><br>
                Anyway, the best way of to know CustomState is to see examples.
            </p><br>


            <hr><br>

            <h3>Coding tips</h3><br><br>

            <h4>The end of CustomState</h4>

            <p>
                The engine does NOT reset arena automatically when customstate has ended.
                You should call <span class="term">StateEditor.ResetArena()</span> in <span class="term">StateEnding()</span> when you modify arena with <span class="term">the arena object</span>.
                (If you will enter to <span class="term">DEFENDING</span>, probably you don't need it.)
            </p><br>

            <h4>CustomState to CustomState</h4>

            <p>
                I think you sometimes want to change CustomState to another CustomState.<br>
                If you want to do: you can change <span class="term">customstatename</span> by use <span class="term">Encounter["customstatename"]</span> and I recommend that you should put <span class="term">State("CUSTOMSTATE")</span> in the END of <span class="term">Update()</span>.
            </p><br>
        </div>

        <div class="tab-pane text-style" id="mercy">
            <h2 style="text-decoration: none; line-height:50px;">
                * YOU WON!<br>
                * You earned 0 EXP and 0 gold.<br>
                * also the nav menu is broken now
            </h2><br>
        </div>
    </div>
</div>

<div class="container">
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/fightbt_0.png" height="42">
    </div>
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/actbt_0.png" height="42">
    </div>
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/itembt_0.png" height="42">
    </div>
    <div class="col-xs-3"><a href="#mercy" data-toggle="tab"><img class="centerbt black" alt="Undertale fake button"
                                                                  src="../img/mercybt_0.png" height="42"></a>
    </div>
</div>
<br>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/show_hide_comments.js"></script>

<script type="text/javascript" src="../js/FontToggleButton.js"></script>
</body>
</html>